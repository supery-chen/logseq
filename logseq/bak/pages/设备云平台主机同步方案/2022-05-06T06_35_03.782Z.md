public:: false

- #工作 #控客 #私有
- > 根据主机表现,实时更新画像
  根据主机画像,对主机进行打分
  根据主机打分,按优先级同步主机
	-
- ## 数据源
- > 数据主要来自kafka,处理后转换为打分平台对应事件,具体信息如下表
- |topic|来源|事件|
  |--|--|--|
  |inner-ccuRelation|iot-mqtt-auth|CCU_RELATION_CHANGED|
  |cloudReqRespInfo|API、SVC|CCU_OPT_EXECUTE[:br]CCU_OPT_RESP[:br]CCU_OPT_SUCCESS[:br]CCU_OPT_FAILED[:br]CCU_OPT_TIMEOUT|
  |inner-ccuOnline|SVC|CCU_ONLINE|
  |inner-ccuOffline|SVC|CCU_OFFLINE|
  |iot-ccuActive_NoWorkingOnline|SVC|CCU_ACTIVE_NOT_WORKING|
  |iot-ccuLinkHealthCheck_Success|SVC|CCU_HEALTH_CHECK_SUCCESS|
  |iot-ccuLinkHealthCheck_Failed|SVC|CCU_HEALTH_CHECK_FAILED|
  |iot-ccuWorkingOnline|SVC|CCU_SYNC_SUCCESS|
  |iot-ccuSync_SYNC_INFO_ERROR|SVC|CCU_SYNC_FAILED|
	-
- ## 画像
- > 根据事件更新画像信息,事件对应画像信息如下表
- | 字段     | 子字段                             | 类型          | 对应事件                 | 事件对应操作 |
  | -------- | ---------------------------------- | ------------- | ------------------------ | ------------ |
  | basic    |                                    | object        |                          |              |
  |          | link                               | int           | CCU_ONLINE               | set 1 |
  |          |                                    |               | CCU_OFFLINE              | set 0 |
  |          |                                    |               | CCU_SYNC_SUCCESS         | set 1 |
  |          |                                    |               | CCU_SYNC_FAILED          | set 1 |
  |          |                                    |               | CCU_OPT_RESP             | set 1 |
  |          |                                    |               | CCU_OPT_SUCCESS          | set 1 |
  |          |                                    |               | CCU_PUSH                 | set 1 |
  |          | link_type                          | string        | CCU_ONLINE               | set `link_type` |
  | stable   |                                    | object |                          |              |
  |          | online_frequency                   | int           | CCU_ONLINE               | incr 1 |
  |          | offline_frequency                  | int           | CCU_OFFLINE              | incr 1 |
  |          | last_online_time                   | long          | CCU_ONLINE               | set `eventTime` |
  |          | last_offline_time                  | long          | CCU_OFFLINE              | set `eventTime` |
  |          | last_10_onoff_records              | list\<string> | CCU_ONLINE               | add `eventTime@eventType@linkType` |
  |          |                                    |               | CCU_OFFLINE              | add `eventTime@eventType@linkType` |
  |          | sync_frequency                     | int           | CCU_SYNC_SUCCESS         | incr 1 |
  |          |                                    |               | CCU_SYNC_FAILED          | incr 1 |
  |          | sync_success_frequency             | int           | CCU_SYNC_SUCCESS         | incr 1 |
  |          | last_sync_complete_time            | long          | CCU_SYNC_SUCCESS         | set `eventTime` |
  |          |                                    |               | CCU_SYNC_FAILED          | set `eventTime` |
  |          | last_sync_complete_result          | string        | CCU_SYNC_SUCCESS         | set `eventType` |
  |          |                                    |               | CCU_SYNC_FAILED          | set `eventType` |
  |          | last_20_sync_result_records        | list\<string> | CCU_SYNC_SUCCESS         | add `eventTime@eventType` |
  |          |                                    |               | CCU_SYNC_FAILED          | add `eventTime@eventType` |
  |          | opt_frequency                      | int           | CCU_OPT_EXECUTE          | incr 1 |
  |          | opt_success_frequency              | int           | CCU_OPT_SUCCESS          | incr 1 |
  |          | last_opt_complete_time             | long          | CCU_OPT_SUCCESS          | set `eventTime` |
  |          |                                    |               | CCU_OPT_FAILED           | set `eventTime` |
  |          |                                    |               | CCU_OPT_TIMEOUT          | set `eventTime` |
  |          | last_opt_complete_result           | string        | CCU_OPT_SUCCESS          | set `eventType` |
  |          |                                    |               | CCU_OPT_FAILED           | set `eventType` |
  |          |                                    |               | CCU_OPT_TIMEOUT          | set `eventType` |
  |          | last_50_opt_result_records         | list\<string> | CCU_OPT_SUCCESS          | add `eventTime@eventType` |
  |          |                                    |               | CCU_OPT_FAILED           | add `eventTime@eventType` |
  |          |                                    |               | CCU_OPT_TIMEOUT          | add `eventTime@eventType` |
  |          | no_link_frequency                  | int           | CCU_SYNC_SUCCESS         | set 0 |
  |          |                                    |               | CCU_OPT_FAILED           |              |
  |          | last_100_no_link_times             | list\<long>   | CCU_SYNC_SUCCESS         |              |
  |          |                                    |               | CCU_OPT_FAILED           |              |
  |          | active_no_working_online           | int           | CCU_SYNC_SUCCESS         |              |
  |          |                                    |               | CCU_ACTIVE_NOT_WORKING   |              |
  |          | last_active_no_working_online_time | long          | CCU_SYNC_SUCCESS         |              |
  |          |                                    |               | CCU_ACTIVE_NOT_WORKING   |              |
  |          | health_check_success_frequency     | int           | CCU_SYNC_SUCCESS         |              |
  |          |                                    |               | CCU_ACTIVE_NOT_WORKING   |              |
  |          |                                    |               | CCU_HEALTH_CHECK_SUCCESS |              |
  |          | last_health_check_success_time     | long          | CCU_SYNC_SUCCESS         |              |
  |          |                                    |               | CCU_ACTIVE_NOT_WORKING   |              |
  |          |                                    |               | CCU_HEALTH_CHECK_SUCCESS |              |
  |          | health_check_failed_frequency      | int           | CCU_SYNC_SUCCESS         |              |
  |          |                                    |               | CCU_ACTIVE_NOT_WORKING   |              |
  |          |                                    |               | CCU_HEALTH_CHECK_FAILED  |              |
  |          | last_health_check_failed_time      | long          | CCU_SYNC_SUCCESS         |              |
  |          |                                    |               | CCU_ACTIVE_NOT_WORKING   |              |
  |          |                                    |               | CCU_HEALTH_CHECK_FAILED  |              |
  | active   |                                    | object |                          |              |
  |          | opt_frequency                      | int           | CCU_OPT_EXECUTE          |              |
  |          | last_opt_time                      | long          | CCU_OPT_EXECUTE          |              |
  |          | last_100_opt_times                 | list\<long>   | CCU_OPT_EXECUTE          |              |
  |          | push_frequency                     | int           | CCU_PUSH                 |              |
  |          | last_push_time                     | long          | CCU_PUSH                 |              |
  |          | last_100_push_times                | list\<long>   | CCU_PUSH                 |              |
  | relation |                                    | object |                          |              |
  |          | user_count                         | int           | CCU_RELATION_CHANGED     |              |
  |          | users                              | list\<string> | CCU_RELATION_CHANGED     |              |
  |          | device_count                       | int           | CCU_RELATION_CHANGED     |              |
  |          | devices                            | list\<string> | CCU_RELATION_CHANGED     |              |
  |-|||||
- ## 打分
- ## 同步

